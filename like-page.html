<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Liked Cases Page">
    <title>Liked Cases</title>
    <link rel="stylesheet" href="like-page.css">
</head>
<body>
    <div class="container">
        <!-- 顶部标题区域 -->
        <section class="top-section">
            <div class="title-container">
                <h1 class="page-title">My Likes</h1>
                <p class="page-subtitle">View all cases you've liked</p>
            </div>
        </section>

        <!-- 案例卡片网格 -->
        <section class="cases-section">
            <div class="cases-container">
                <div class="cases-grid" id="likedCasesGrid">
                    <!-- 案例卡片将通过JavaScript动态加载 -->
                </div>
                
                <!-- 空状态提示 -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">
                        <img src="images/heart icon.png" alt="Heart Icon" class="empty-icon-img">
                    </div>
                    <h2 class="empty-title">No liked cases yet</h2>
                    <p class="empty-text">Discover more amazing content in the case library!</p>
                    <button class="empty-btn" onclick="window.location.href='index.html'">Go to Case Library</button>
                </div>
            </div>
        </section>

        <!-- 左上角返回按钮 -->
        <button class="back-btn" onclick="window.location.href='index.html'" aria-label="返回">
            <img src="images/back icon.png" alt="Back" class="back-icon-img">
        </button>
        
        <!-- 右上角头像按钮和下拉菜单 -->
        <div class="user-menu-container">
            <button class="user-avatar-btn" id="userMenuBtn" aria-label="用户菜单">
                <img src="images/头像.png" alt="用户头像" class="user-avatar-img">
            </button>
            <!-- 用户下拉菜单 -->
            <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
                <!-- 顶部区域：头像和用户信息 -->
                <div class="menu-header">
                    <div class="menu-header-info">
                        <img src="images/头像.png" alt="个人头像" class="menu-header-avatar">
                        <div class="menu-header-user-info">
                            <div class="menu-header-user-name">User Name</div>
                            <div class="menu-header-user-email">user@example.com</div>
                        </div>
                    </div>
                    <button class="menu-switch-btn" aria-label="切换">
                        <img src="images/切换icon.png" alt="切换" class="menu-switch-icon">
                    </button>
                </div>
                <!-- 菜单项列表 -->
                <div class="menu-items-list">
                    <a href="like-page.html" class="menu-item">
                        <img src="images/heart icon.png" alt="likes" class="menu-item-icon">
                        <span class="menu-item-text">Likes</span>
                    </a>
                    <a href="collect-page.html" class="menu-item">
                        <img src="images/collect icon.png" alt="collect" class="menu-item-icon">
                        <span class="menu-item-text">Collect</span>
                    </a>
                    <a href="follow-page.html" class="menu-item">
                        <img src="images/follow icon.png" alt="follow" class="menu-item-icon">
                        <span class="menu-item-text">Follow</span>
                    </a>
                    <div class="menu-divider"></div>
                    <a href="#" class="menu-item">
                        <img src="images/Settings icon.png" alt="setting" class="menu-item-icon">
                        <span class="menu-item-text">Settings</span>
                    </a>
                    <a href="#" class="menu-item menu-item-danger">
                        <img src="images/sign out icon.png" alt="sign out" class="menu-item-icon">
                        <span class="menu-item-text">Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 读取主题设置 -->
    <script>
        // 从localStorage读取保存的主题并应用到页面
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
    
    <!-- JavaScript 控制用户菜单 -->
    <script>
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdownMenu = document.getElementById('userDropdownMenu');
        
        if (userMenuBtn && userDropdownMenu) {
            userMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const isVisible = userDropdownMenu.style.display === 'block';
                userDropdownMenu.style.display = isVisible ? 'none' : 'block';
            });
            
            // 点击外部关闭菜单
            document.addEventListener('click', function(e) {
                if (!userMenuBtn.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                    userDropdownMenu.style.display = 'none';
                }
            });
        }
    </script>

    <!-- JavaScript 加载点赞的案例 -->
    <script>
        // 从localStorage获取点赞的案例列表（完整对象数组）
        function getLikedCases() {
            const liked = localStorage.getItem('likedCases');
            return liked ? JSON.parse(liked) : [];
        }

        // 创建案例卡片HTML
        function createCaseCard(caseData) {
            return `
                <article class="case-card" data-card-id="${caseData.id}">
                    <div class="card-image">
                        <img src="${caseData.image}" alt="${caseData.title}" class="card-main-image">
                        <!-- 渐变蒙版（悬停显示） -->
                        <div class="card-gradient-overlay"></div>
                        <!-- 卡片操作按钮（悬停显示） -->
                        <div class="card-actions">
                            <button class="action-like-btn active" aria-label="Like" title="Like">
                                <img src="images/heart icon.png" alt="Like" class="action-icon-img">
                            </button>
                            <button class="action-bookmark-btn" aria-label="Bookmark" title="Bookmark">
                                <img src="images/collect icon.png" alt="Bookmark" class="action-icon-img">
                            </button>
                        </div>
                    </div>
                    <h3 class="card-title">${caseData.title}</h3>
                    <div class="card-stats">
                        <div class="stat-item like-stat" data-liked="true">
                            <img src="images/heart icon.png" alt="Like" class="card-stat-icon">
                            <span class="stat-number like-count">${caseData.likeCount}</span>
                        </div>
                        <div class="stat-item bookmark-stat" data-bookmarked="false">
                            <img src="images/collect icon.png" alt="Bookmark" class="card-stat-icon">
                            <span class="stat-number">${caseData.bookmarkCount}</span>
                        </div>
                    </div>
                </article>
            `;
        }

        // 加载点赞的案例
        function loadLikedCases() {
            const likedCases = getLikedCases();
            const casesGrid = document.getElementById('likedCasesGrid');
            const emptyState = document.getElementById('emptyState');

            if (!likedCases || likedCases.length === 0) {
                if (casesGrid) casesGrid.style.display = 'none';
                if (emptyState) emptyState.style.display = 'flex';
                return;
            }

            // 跳过第一个案例卡片，从第二个开始
            const filteredCases = likedCases.slice(1);
            
            if (filteredCases.length === 0) {
                if (casesGrid) casesGrid.style.display = 'none';
                if (emptyState) emptyState.style.display = 'flex';
                return;
            }

            if (casesGrid) casesGrid.style.display = 'grid';
            if (emptyState) emptyState.style.display = 'none';
            if (casesGrid) casesGrid.innerHTML = '';

            // 如果第二个案例存在，更新其内容和布局与index.html第一个案例一致
            if (filteredCases.length > 0 && likedCases.length > 1) {
                filteredCases[0] = {
                    id: likedCases[1].id || 2,
                    title: "CyberBrick 4WD car",
                    image: "images/case-main-image.png",
                    likeCount: "2.3k",
                    bookmarkCount: "668"
                };
            }

            // 显示被点赞的案例（跳过第一个）
            filteredCases.forEach(caseData => {
                if (casesGrid) {
                    casesGrid.innerHTML += createCaseCard(caseData);
                }
            });

            // 为每个卡片添加事件监听
            attachCardEvents();
        }

        // 为卡片添加事件监听
        function attachCardEvents() {
            const caseCards = document.querySelectorAll('.case-card');
            
            caseCards.forEach(function(card) {
                // 点击卡片跳转到详情页
                card.addEventListener('click', function(e) {
                    if (e.target.closest('button') || e.target.closest('.card-actions')) {
                        e.stopPropagation();
                        return;
                    }
                    window.location.href = 'case-detail.html';
                });

                // 点赞和收藏功能
                const likeStat = card.querySelector('.like-stat');
                const likeCount = card.querySelector('.like-count');
                const actionLikeBtn = card.querySelector('.action-like-btn');
                
                const bookmarkStat = card.querySelector('.bookmark-stat');
                const actionBookmarkBtn = card.querySelector('.action-bookmark-btn');

                function parseCount(countText) {
                    if (countText.includes('k')) {
                        return parseFloat(countText) * 1000;
                    }
                    return parseInt(countText) || 0;
                }

                function formatCount(count) {
                    if (count >= 1000) {
                        return (count / 1000).toFixed(1) + 'k';
                    }
                    return count.toString();
                }

                function toggleLike() {
                    const isLiked = likeStat.getAttribute('data-liked') === 'true';
                    const currentCount = parseCount(likeCount.textContent);
                    const cardId = parseInt(card.getAttribute('data-card-id'));
                    let likedCases = getLikedCases();
                    
                    // 获取案例数据
                    const cardTitle = card.querySelector('.card-title') ? card.querySelector('.card-title').textContent : 'Case ' + cardId;
                    const cardImage = card.querySelector('.card-main-image') ? card.querySelector('.card-main-image').src : '';
                    const likeCountText = likeCount.textContent;
                    const bookmarkCountText = card.querySelector('.bookmark-stat .stat-number') ? card.querySelector('.bookmark-stat .stat-number').textContent : '0';
                    
                    const caseData = {
                        id: cardId,
                        title: cardTitle,
                        image: cardImage,
                        likeCount: likeCountText,
                        bookmarkCount: bookmarkCountText
                    };

                    if (isLiked) {
                        likeStat.setAttribute('data-liked', 'false');
                        likeCount.textContent = formatCount(currentCount - 1);
                        if (actionLikeBtn) {
                            actionLikeBtn.classList.remove('active');
                            const iconImg = actionLikeBtn.querySelector('.action-icon-img');
                            if (iconImg) {
                                iconImg.src = 'images/heart icon.png';
                            }
                        }
                        // 从localStorage中移除
                        likedCases = likedCases.filter(c => c.id !== cardId);
                        localStorage.setItem('likedCases', JSON.stringify(likedCases));
                        // 重新加载页面以更新列表
                        setTimeout(() => loadLikedCases(), 100);
                    } else {
                        likeStat.setAttribute('data-liked', 'true');
                        likeCount.textContent = formatCount(currentCount + 1);
                        if (actionLikeBtn) {
                            actionLikeBtn.classList.add('active');
                            const iconImg = actionLikeBtn.querySelector('.action-icon-img');
                            if (iconImg) {
                                iconImg.src = 'images/blueHeart.png';
                            }
                        }
                        // 添加到localStorage
                        const existingIndex = likedCases.findIndex(c => c.id === cardId);
                        if (existingIndex === -1) {
                            likedCases.push(caseData);
                        } else {
                            likedCases[existingIndex] = caseData;
                        }
                        localStorage.setItem('likedCases', JSON.stringify(likedCases));
                    }
                }
                
                function toggleBookmark() {
                    const isBookmarked = bookmarkStat.getAttribute('data-bookmarked') === 'true';
                    const cardId = parseInt(card.getAttribute('data-card-id'));
                    let bookmarkedCases = getBookmarkedCases();
                    
                    // 获取案例数据
                    const cardTitle = card.querySelector('.card-title') ? card.querySelector('.card-title').textContent : 'Case ' + cardId;
                    const cardImage = card.querySelector('.card-main-image') ? card.querySelector('.card-main-image').src : '';
                    const likeCountText = card.querySelector('.like-count') ? card.querySelector('.like-count').textContent : '0';
                    const bookmarkCountText = card.querySelector('.bookmark-stat .stat-number') ? card.querySelector('.bookmark-stat .stat-number').textContent : '0';
                    
                    const caseData = {
                        id: cardId,
                        title: cardTitle,
                        image: cardImage,
                        likeCount: likeCountText,
                        bookmarkCount: bookmarkCountText
                    };
                    
                    if (isBookmarked) {
                        bookmarkStat.setAttribute('data-bookmarked', 'false');
                        if (actionBookmarkBtn) {
                            actionBookmarkBtn.classList.remove('active');
                            const iconImg = actionBookmarkBtn.querySelector('.action-icon-img');
                            if (iconImg) {
                                iconImg.src = 'images/collect icon.png';
                            }
                        }
                        // 从localStorage中移除
                        bookmarkedCases = bookmarkedCases.filter(c => c.id !== cardId);
                        localStorage.setItem('bookmarkedCases', JSON.stringify(bookmarkedCases));
                        // 如果在collect页面，重新加载列表
                        if (window.location.pathname.includes('collect-page.html')) {
                            setTimeout(() => loadCollectedCases(), 100);
                        }
                    } else {
                        bookmarkStat.setAttribute('data-bookmarked', 'true');
                        if (actionBookmarkBtn) {
                            actionBookmarkBtn.classList.add('active');
                            const iconImg = actionBookmarkBtn.querySelector('.action-icon-img');
                            if (iconImg) {
                                iconImg.src = 'images/blueBookmark.png';
                            }
                        }
                        // 添加到localStorage
                        const existingIndex = bookmarkedCases.findIndex(c => c.id === cardId);
                        if (existingIndex === -1) {
                            bookmarkedCases.push(caseData);
                        } else {
                            bookmarkedCases[existingIndex] = caseData;
                        }
                        localStorage.setItem('bookmarkedCases', JSON.stringify(bookmarkedCases));
                    }
                }
                
                // 获取收藏的案例列表
                function getBookmarkedCases() {
                    const bookmarked = localStorage.getItem('bookmarkedCases');
                    return bookmarked ? JSON.parse(bookmarked) : [];
                }

                function toggleBookmark() {
                    const isBookmarked = bookmarkStat.getAttribute('data-bookmarked') === 'true';
                    
                    if (isBookmarked) {
                        bookmarkStat.setAttribute('data-bookmarked', 'false');
                        if (actionBookmarkBtn) {
                            actionBookmarkBtn.classList.remove('active');
                        }
                    } else {
                        bookmarkStat.setAttribute('data-bookmarked', 'true');
                        if (actionBookmarkBtn) {
                            actionBookmarkBtn.classList.add('active');
                        }
                    }
                }

                if (actionLikeBtn && likeStat && likeCount) {
                    actionLikeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleLike();
                    });
                }

                if (actionBookmarkBtn && bookmarkStat) {
                    actionBookmarkBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleBookmark();
                    });
                }
            });
        }

        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', function() {
            loadLikedCases();
        });
        
        // 页面可见性变化时重新加载（从其他页面返回时）
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadLikedCases();
            }
        });
        
        // 窗口获得焦点时重新加载
        window.addEventListener('focus', function() {
            loadLikedCases();
        });
    </script>
</body>
</html>

