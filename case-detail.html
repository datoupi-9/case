<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Case Detail Page">
    <title>Case Detail - CyberBrick 4WD</title>
    <link rel="stylesheet" href="case-detail.css">
</head>
<body>
    <!-- 主容器 -->
    <div class="container">
        
        <!-- 返回按钮 -->
        <button class="back-btn" onclick="window.location.href='index.html'" aria-label="Back">
            <img src="images/back icon.png" alt="Back" class="back-icon-img">
        </button>
        
        <!-- 主要内容区域 -->
        <div class="main-content">
            <!-- 左侧：案例内容 -->
            <div class="case-content">
                <!-- 案例标题 -->
                <header class="case-header">
                    <h1 class="case-title">CyberBrick 4WD - Free 3D Printing Model - MakerWorld</h1>
                    <div class="case-meta">
                        <div class="meta-item">
                            <div class="designer-avatar-wrapper">
                                <img src="images/头像.png" alt="Designer" class="designer-icon" id="designerAvatar">
                                <button class="follow-add-btn" id="followBtn" data-designer="Asif lpbal" aria-label="Follow Designer" title="Follow Designer">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="follow-icon">
                                        <circle cx="6" cy="6" r="5.5" fill="#6798FF" stroke="#FFFFFF" stroke-width="1"/>
                                        <path d="M6 3V9M3 6H9" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="follow-check" style="display: none;">
                                        <circle cx="6" cy="6" r="5.5" fill="#3E6AE2" stroke="#FFFFFF" stroke-width="1"/>
                                        <path d="M3 6L5.5 8.5L9 4.5" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                            <span class="case-author">Asif lpbal</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Release Date:</span>
                            <span class="case-date">December 29, 2025</span>
                        </div>
                    </div>
                </header>
                
                <!-- 设计背景与特点 - 图片上方 -->
                <section class="design-background">
                    <h2 class="section-title">Design Background & Features</h2>
                    <p class="description-text">
                        To fulfill the dream of creating a precision mechanical remote-controlled car, the designer has developed a new vehicle with a double-wishbone independent suspension system, based on the previously popular CyberBrick 4X4 Jeep model (with over 2000 downloads). The new car is more compact, faster, and features a unique combined lighting system (allowing separate operation of headlights and turn signals).
                    </p>
                </section>
                
                <!-- 制作细节与建议 - 图片上方 -->
                <section class="making-details">
                    <h2 class="section-title">Production Details & Suggestions</h2>
                    
                    <div class="detail-item">
                        <h3 class="detail-subtitle">Lighting System</h3>
                        <p class="description-text">
                            The designer explains that due to hardware limitations (insufficient LED wire length), the taillights were designed with long transparent components and underwent extensive testing. He recommends using the provided "LED Transparent Parts" printing configuration for clearer results.
                        </p>
                    </div>
                    
                    <div class="detail-item">
                        <h3 class="detail-subtitle">Printing Materials</h3>
                        <p class="description-text">
                            Clear printing recommendations are provided for each part: tires with TPU or PEBA, light covers with transparent PETG, structural components with PLA-CF, and the body can use any preferred material.
                        </p>
                    </div>
                    
                    <div class="detail-item">
                        <h3 class="detail-subtitle">Design Input & Support</h3>
                        <p class="description-text">
                            The designer has invested significant effort in creating detailed assembly guides and providing STP files for the chassis and wheels to facilitate user remixing. He has decided to release this model as an exclusive on the MakerWorld platform. Users can support him by clicking "Buy Now" to provide commission incentives.
                        </p>
                    </div>
                </section>
                
                <!-- 案例图片内容 -->
                <section class="case-images">
                    <div class="image-gallery">
                        <!-- 图片方框网格 -->
                        <div class="image-grid">
                            <div class="gallery-item">
                                <img src="images/case1.1.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                            <div class="gallery-item">
                                <img src="images/case1.2.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                            <div class="gallery-item">
                                <img src="images/case1.3.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                            <div class="gallery-item">
                                <img src="images/case1.4.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                            <div class="gallery-item">
                                <img src="images/case1.5.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                            <div class="gallery-item">
                                <img src="images/case1.6.png" alt="CyberBrick 4WD" class="gallery-image">
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 版权说明 - 图片下方 -->
                <section class="copyright-notice">
                    <div class="copyright-content">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="copyright-icon">
                            <circle cx="10" cy="10" r="9" stroke="#838383" stroke-width="1.5"/>
                            <path d="M10 6V10M10 14H10.01" stroke="#838383" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <p class="copyright-text">
                            <strong>Copyright Notice:</strong> The model is protected by the MakerWorld Exclusive License, which allows the creation of derivative works, but they must only be published on the MakerWorld platform with attribution to the original creator. Any commercial use is strictly prohibited.
                        </p>
                    </div>
                </section>
            </div>
            
            <!-- 垂直分隔线 -->
            <div class="vertical-divider"></div>
            
            <!-- 右侧：评论区域 -->
            <aside class="comments-section">
                <!-- 操作按钮 - 点赞、收藏、转发、跳转 -->
                <div class="comment-actions-bar">
                    <button class="comment-action-btn like-action-btn" aria-label="Like" title="Like">
                        <img src="images/heart icon.png" alt="Like" class="action-icon-img">
                    </button>
                    
                    <button class="comment-action-btn bookmark-action-btn" aria-label="Bookmark" title="Bookmark">
                        <img src="images/collect icon.png" alt="Bookmark" class="action-icon-img">
                    </button>
                    
                    <button class="comment-action-btn share-action-btn" aria-label="Share" title="Share">
                        <img src="images/转发icon.png" alt="Share" class="action-icon-img">
                    </button>
                    
                    <button class="comment-action-btn link-action-btn" aria-label="Link" title="Link" onclick="window.open('https://makerworld.com.cn/zh/models/1949321-cyberbrick-si-qu-che#profileId-2165973', '_blank')">
                        <img src="images/link icon.png" alt="Link" class="action-icon-img">
                    </button>
                </div>
                
                <div class="comments-header">
                    <h2 class="comments-title">Comments</h2>
                    <span class="comments-count">24</span>
                </div>
                
                <!-- 评论输入框 -->
                <div class="comment-input-area">
                    <div class="comment-avatar">
                        <img src="images/头像.png" alt="Avatar" class="comment-avatar-img">
                    </div>
                    <div class="comment-input-wrapper">
                        <input type="text" class="comment-input" placeholder="Add a comment..." aria-label="Add comment" maxlength="500">
                        <button class="comment-submit-btn" aria-label="Send" disabled>
                            <img src="images/Email Send.png" alt="Send" class="comment-send-icon">
                        </button>
                    </div>
                    <div class="comment-char-count" style="display: none;">0/500</div>
                </div>
                
                <!-- 评论列表 -->
                <div class="comments-list">
                    <!-- 评论项 1 -->
                    <article class="comment-item">
                        <div class="comment-avatar">
                            <img src="images/头像.png" alt="Avatar" class="comment-avatar-img">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">Alex Johnson</span>
                                <span class="comment-time">2 hours ago</span>
                            </div>
                            <p class="comment-text">This is absolutely stunning! The design is so clean and modern. Great work!</p>
                            <div class="comment-actions">
                                <button class="comment-like-btn" aria-label="Like comment">
                                    <img src="images/heart icon.png" alt="Like" class="comment-like-icon">
                                    <span>12</span>
                                </button>
                                <button class="comment-reply-btn">Reply</button>
                            </div>
                        </div>
                    </article>
                    
                    <!-- 评论项 2 -->
                    <article class="comment-item">
                        <div class="comment-avatar">
                            <img src="images/头像.png" alt="Avatar" class="comment-avatar-img">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">Sarah Chen</span>
                                <span class="comment-time">5 hours ago</span>
                            </div>
                            <p class="comment-text">Love the color scheme and typography choices. Very professional!</p>
                            <div class="comment-actions">
                                <button class="comment-like-btn" aria-label="Like comment">
                                    <img src="images/heart icon.png" alt="Like" class="comment-like-icon">
                                    <span>8</span>
                                </button>
                                <button class="comment-reply-btn">Reply</button>
                            </div>
                        </div>
                    </article>
                    
                    <!-- 评论项 3 -->
                    <article class="comment-item">
                        <div class="comment-avatar">
                            <img src="images/头像.png" alt="Avatar" class="comment-avatar-img">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">Mike Davis</span>
                                <span class="comment-time">1 day ago</span>
                            </div>
                            <p class="comment-text">The user experience flow is really well thought out. Can't wait to see more!</p>
                            <div class="comment-actions">
                                <button class="comment-like-btn" aria-label="Like comment">
                                    <img src="images/heart icon.png" alt="Like" class="comment-like-icon">
                                    <span>15</span>
                                </button>
                                <button class="comment-reply-btn">Reply</button>
                            </div>
                        </div>
                    </article>
                    
                    <!-- 评论项 4 -->
                    <article class="comment-item">
                        <div class="comment-avatar">
                            <img src="images/头像.png" alt="Avatar" class="comment-avatar-img">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">Emma Wilson</span>
                                <span class="comment-time">2 days ago</span>
                            </div>
                            <p class="comment-text">The attention to detail is impressive. Every element feels intentional and purposeful.</p>
                            <div class="comment-actions">
                                <button class="comment-like-btn" aria-label="Like comment">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 14L3 9C2 8 1 6.5 1 4.5C1 2.5 2.5 1 4.5 1C6 1 7.5 1.5 8.5 2.5L8 3L9.5 2C10.5 1 12 0.5 13.5 0.5C15.5 0.5 17 2 17 4.5C17 6.5 16 8 15 9L8 14Z" stroke="#666" stroke-width="1.2"/>
                                    </svg>
                                    <span>6</span>
                                </button>
                                <button class="comment-reply-btn">Reply</button>
                            </div>
                        </div>
                    </article>
                </div>
            </aside>
        </div>
        
        <!-- 右上角头像按钮和下拉菜单 -->
        <div class="user-menu-container">
            <button class="user-avatar-btn" id="userMenuBtn" aria-label="用户菜单">
                <img src="images/头像.png" alt="用户头像" class="user-avatar-img">
            </button>
            <!-- 用户下拉菜单 -->
            <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
                <!-- 顶部区域：头像和用户信息 -->
                <div class="menu-header">
                    <div class="menu-header-info">
                        <img src="images/头像.png" alt="个人头像" class="menu-header-avatar">
                        <div class="menu-header-user-info">
                            <div class="menu-header-user-name">User Name</div>
                            <div class="menu-header-user-email">user@example.com</div>
                        </div>
                    </div>
                    <button class="menu-switch-btn" aria-label="切换">
                        <img src="images/切换icon.png" alt="切换" class="menu-switch-icon">
                    </button>
                </div>
                <!-- 菜单项列表 -->
                <div class="menu-items-list">
                    <a href="like-page.html" class="menu-item">
                        <img src="images/heart icon.png" alt="likes" class="menu-item-icon">
                        <span class="menu-item-text">Likes</span>
                    </a>
                    <a href="collect-page.html" class="menu-item">
                        <img src="images/collect icon.png" alt="collect" class="menu-item-icon">
                        <span class="menu-item-text">Collect</span>
                    </a>
                    <a href="follow-page.html" class="menu-item">
                        <img src="images/follow icon.png" alt="follow" class="menu-item-icon">
                        <span class="menu-item-text">Follow</span>
                    </a>
                    <div class="menu-divider"></div>
                    <a href="#" class="menu-item">
                        <img src="images/Settings icon.png" alt="setting" class="menu-item-icon">
                        <span class="menu-item-text">Settings</span>
                    </a>
                    <a href="#" class="menu-item menu-item-danger">
                        <img src="images/sign out icon.png" alt="sign out" class="menu-item-icon">
                        <span class="menu-item-text">Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 读取主题设置 -->
    <script>
        // 从localStorage读取保存的主题并应用到页面
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // 更新返回按钮图片的函数
        function updateBackButtonIcon(theme) {
            const backIconImg = document.querySelector('.back-icon-img');
            if (backIconImg) {
                backIconImg.src = theme === 'light' ? 'images/浅色back button.png' : 'images/back icon.png';
            }
        }
        
        // 更新右上角头像的函数
        function updateAvatarImage(theme) {
            const userAvatarImg = document.querySelector('.user-avatar-img');
            if (userAvatarImg) {
                userAvatarImg.src = theme === 'light' ? 'images/白头像.png' : 'images/头像.png';
            }
        }
        
        // 更新下拉菜单图标的函数
        function updateDropdownMenuIcons(theme) {
            const menuHeaderAvatar = document.querySelector('.menu-header-avatar');
            const menuSwitchIcon = document.querySelector('.menu-switch-icon');
            const menuItemIcons = document.querySelectorAll('.menu-item-icon');
            
            // 更新菜单头部头像
            if (menuHeaderAvatar) {
                menuHeaderAvatar.src = theme === 'light' ? 'images/白头像.png' : 'images/头像.png';
            }
            
            // 更新切换按钮图标
            if (menuSwitchIcon) {
                menuSwitchIcon.src = theme === 'light' ? 'images/白Transfer.png' : 'images/切换icon.png';
            }
            
            // 更新菜单项图标（从上到下）
            if (menuItemIcons.length > 0) {
                const lightIcons = [
                    'images/白Heart.png',      // Likes
                    'images/白Bookmark.png',   // Collect
                    'images/白Add User Male.png', // Follow
                    'images/白Settings.png',   // Settings
                    'images/白Logout Rounded.png' // Sign Out
                ];
                const darkIcons = [
                    'images/heart icon.png',
                    'images/collect icon.png',
                    'images/follow icon.png',
                    'images/Settings icon.png',
                    'images/sign out icon.png'
                ];
                
                menuItemIcons.forEach((icon, index) => {
                    if (index < lightIcons.length) {
                        icon.src = theme === 'light' ? lightIcons[index] : darkIcons[index];
                    }
                });
            }
        }
        
        // 初始化右上角头像
        updateAvatarImage(savedTheme);
        // 初始化返回按钮图标
        updateBackButtonIcon(savedTheme);
        // 初始化下拉菜单图标
        updateDropdownMenuIcons(savedTheme);
    </script>
    
    <!-- JavaScript 控制用户菜单 -->
    <script>
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdownMenu = document.getElementById('userDropdownMenu');
        
        userMenuBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (userDropdownMenu.style.display === 'none' || userDropdownMenu.style.display === '') {
                userDropdownMenu.style.display = 'block';
            } else {
                userDropdownMenu.style.display = 'none';
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!userMenuBtn.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                userDropdownMenu.style.display = 'none';
            }
        });
    </script>
    
    <!-- JavaScript 处理 Designer Follow 功能 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const followBtn = document.getElementById('followBtn');
            const designerAvatar = document.getElementById('designerAvatar');
            const designerName = followBtn ? followBtn.getAttribute('data-designer') : '';
            
            if (!followBtn || !designerName) return;
            
            // 从localStorage获取关注的designer列表
            function getFollowedDesigners() {
                const followed = localStorage.getItem('followedDesigners');
                return followed ? JSON.parse(followed) : [];
            }
            
            // 检查是否已关注
            function isFollowing() {
                const followedDesigners = getFollowedDesigners();
                return followedDesigners.includes(designerName);
            }
            
            // 更新按钮状态
            function updateButtonState() {
                if (isFollowing()) {
                    followBtn.classList.add('active');
                    if (designerAvatar) {
                        designerAvatar.style.borderColor = '#3E6AE2';
                    }
                } else {
                    followBtn.classList.remove('active');
                    if (designerAvatar) {
                        designerAvatar.style.borderColor = 'transparent';
                    }
                }
            }
            
            // 切换关注状态
            function toggleFollow(e) {
                if (e) {
                    e.stopPropagation();
                }
                
                let followedDesigners = getFollowedDesigners();
                let wasFollowing = isFollowing();
                
                // 设计者完整信息
                const designerData = {
                    name: designerName,
                    avatar: 'images/头像.png',
                    description: 'Creative designer specializing in 3D modeling',
                    caseCount: 1
                };
                
                if (wasFollowing) {
                    // 取消关注
                    followedDesigners = followedDesigners.filter(d => d.name !== designerName);
                    localStorage.setItem('followedDesigners', JSON.stringify(followedDesigners));
                } else {
                    // 添加关注
                    const existingIndex = followedDesigners.findIndex(d => d.name === designerName);
                    if (existingIndex === -1) {
                        followedDesigners.push(designerData);
                    } else {
                        followedDesigners[existingIndex] = designerData;
                    }
                    localStorage.setItem('followedDesigners', JSON.stringify(followedDesigners));
                }
                
                updateButtonState();
                
                // 添加动画效果
                if (followBtn) {
                    followBtn.style.animation = 'none';
                    setTimeout(() => {
                        followBtn.style.animation = 'pulse 0.3s ease';
                    }, 10);
                }
                
                // 头像点击反馈
                if (designerAvatar && !wasFollowing) {
                    designerAvatar.style.animation = 'none';
                    setTimeout(() => {
                        designerAvatar.style.animation = 'avatarPulse 0.4s ease';
                    }, 10);
                }
            }
            
            // 关注按钮点击事件
            followBtn.addEventListener('click', toggleFollow);
            
            // 头像点击事件（点击头像也可以关注/取消关注）
            if (designerAvatar) {
                designerAvatar.addEventListener('click', toggleFollow);
            }
            
            // 初始化按钮状态
            updateButtonState();
        });
        
        // 评论点赞功能
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.comment-like-btn').forEach(btn => {
                // 为每个按钮存储初始点赞数
                const likeCountSpan = btn.querySelector('span');
                if (likeCountSpan && !btn.dataset.initialCount) {
                    btn.dataset.initialCount = parseInt(likeCountSpan.textContent) || 0;
                    btn.dataset.isLiked = 'false';
                }
                
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isCurrentlyActive = this.classList.contains('active');
                    const likeCountSpan = this.querySelector('span');
                    
                    if (likeCountSpan) {
                        let currentCount = parseInt(likeCountSpan.textContent) || 0;
                        
                        if (isCurrentlyActive) {
                            // 取消点赞，数量减1
                            this.classList.remove('active');
                            currentCount = Math.max(0, currentCount - 1);
                            this.dataset.isLiked = 'false';
                        } else {
                            // 点赞，数量加1
                            this.classList.add('active');
                            currentCount = currentCount + 1;
                            this.dataset.isLiked = 'true';
                        }
                        
                        likeCountSpan.textContent = currentCount;
                    } else {
                        // 如果没有数量显示，只切换状态
                        this.classList.toggle('active');
                    }
                });
            });
        });
        
        // 右上角操作按钮交互功能（点赞、收藏、转发）
        document.addEventListener('DOMContentLoaded', function() {
            const likeBtn = document.querySelector('.like-action-btn');
            const bookmarkBtn = document.querySelector('.bookmark-action-btn');
            const shareBtn = document.querySelector('.share-action-btn');
            
            const caseId = 1; // 案例ID，对应index.html中的card-id=1
            
            // 案例完整信息
            const caseData = {
                id: caseId,
                title: 'CyberBrick 4WD - Free 3D Printing Model - MakerWorld',
                image: 'images/case-main-image.png',
                likeCount: '2.3k',
                bookmarkCount: '668'
            };
            
            // 获取已点赞的案例列表
            function getLikedCases() {
                const liked = localStorage.getItem('likedCases');
                return liked ? JSON.parse(liked) : [];
            }
            
            // 获取已收藏的案例列表
            function getBookmarkedCases() {
                const bookmarked = localStorage.getItem('bookmarkedCases');
                return bookmarked ? JSON.parse(bookmarked) : [];
            }
            
            // 检查是否已点赞
            function isLiked() {
                const likedCases = getLikedCases();
                return likedCases.some(c => c.id === caseId);
            }
            
            // 检查是否已收藏
            function isBookmarked() {
                const bookmarkedCases = getBookmarkedCases();
                return bookmarkedCases.some(c => c.id === caseId);
            }
            
            // 更新点赞按钮状态
            function updateLikeButton() {
                if (isLiked()) {
                    likeBtn.classList.add('active');
                } else {
                    likeBtn.classList.remove('active');
                }
            }
            
            // 更新收藏按钮状态
            function updateBookmarkButton() {
                if (isBookmarked()) {
                    bookmarkBtn.classList.add('active');
                } else {
                    bookmarkBtn.classList.remove('active');
                }
            }
            
            // 更新浅色模式下的按钮图标
            function updateButtonIconsForLightMode() {
                const theme = document.documentElement.getAttribute('data-theme');
                if (theme !== 'light') return;
                
                // 更新点赞按钮图标
                if (likeBtn && likeBtn.classList.contains('active')) {
                    const likeIcon = likeBtn.querySelector('.action-icon-img');
                    if (likeIcon) {
                        likeIcon.src = 'images/浅色Heart.png';
                    }
                }
                
                // 更新收藏按钮图标
                if (bookmarkBtn && bookmarkBtn.classList.contains('active')) {
                    const bookmarkIcon = bookmarkBtn.querySelector('.action-icon-img');
                    if (bookmarkIcon) {
                        bookmarkIcon.src = 'images/浅色Bookmark.png';
                    }
                }
                
                // 更新转发按钮图标
                if (shareBtn && shareBtn.classList.contains('active')) {
                    const shareIcon = shareBtn.querySelector('.action-icon-img');
                    if (shareIcon) {
                        shareIcon.src = 'images/浅色转发.png';
                    }
                }
                
                // 更新链接按钮图标
                const linkBtn = document.querySelector('.link-action-btn');
                if (linkBtn && linkBtn.classList.contains('active')) {
                    const linkIcon = linkBtn.querySelector('.action-icon-img');
                    if (linkIcon) {
                        linkIcon.src = 'images/浅色link.png';
                    }
                }
            }
            
            // 保存点赞案例
            function saveLikedCase(caseData) {
                const likedCases = getLikedCases();
                const existingIndex = likedCases.findIndex(c => c.id === caseData.id);
                
                if (existingIndex === -1) {
                    likedCases.push(caseData);
                } else {
                    likedCases[existingIndex] = caseData;
                }
                
                localStorage.setItem('likedCases', JSON.stringify(likedCases));
            }
            
            // 移除点赞案例
            function removeLikedCase(caseId) {
                const likedCases = getLikedCases();
                const filtered = likedCases.filter(c => c.id !== caseId);
                localStorage.setItem('likedCases', JSON.stringify(filtered));
            }
            
            // 保存收藏案例
            function saveBookmarkedCase(caseData) {
                const bookmarkedCases = getBookmarkedCases();
                const existingIndex = bookmarkedCases.findIndex(c => c.id === caseData.id);
                
                if (existingIndex === -1) {
                    bookmarkedCases.push(caseData);
                } else {
                    bookmarkedCases[existingIndex] = caseData;
                }
                
                localStorage.setItem('bookmarkedCases', JSON.stringify(bookmarkedCases));
            }
            
            // 移除收藏案例
            function removeBookmarkedCase(caseId) {
                const bookmarkedCases = getBookmarkedCases();
                const filtered = bookmarkedCases.filter(c => c.id !== caseId);
                localStorage.setItem('bookmarkedCases', JSON.stringify(filtered));
            }
            
            // 点赞功能（第一个按钮）
            if (likeBtn) {
                likeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isCurrentlyLiked = isLiked();
                    const theme = document.documentElement.getAttribute('data-theme');
                    const iconImg = this.querySelector('.action-icon-img');
                    
                    if (isCurrentlyLiked) {
                        // 取消点赞
                        removeLikedCase(caseId);
                        this.classList.remove('active');
                        // 浅色模式下恢复原图标
                        if (theme === 'light' && iconImg) {
                            iconImg.src = 'images/heart icon.png';
                        } else if (iconImg) {
                            iconImg.src = 'images/heart icon.png';
                        }
                    } else {
                        // 点赞
                        saveLikedCase(caseData);
                        this.classList.add('active');
                        // 浅色模式下切换为浅色图标
                        if (theme === 'light' && iconImg) {
                            iconImg.src = 'images/浅色Heart.png';
                        }
                    }
                    
                    // 添加视觉反馈
                    this.style.animation = 'none';
                    setTimeout(() => {
                        this.style.animation = 'heartBeat 0.4s ease';
                    }, 10);
                });
                
                // 初始化点赞状态
                updateLikeButton();
                // 初始化浅色模式图标
                updateButtonIconsForLightMode();
            }
            
            // 收藏功能
            if (bookmarkBtn) {
                bookmarkBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isCurrentlyBookmarked = isBookmarked();
                    const theme = document.documentElement.getAttribute('data-theme');
                    const iconImg = this.querySelector('.action-icon-img');
                    
                    if (isCurrentlyBookmarked) {
                        // 取消收藏
                        removeBookmarkedCase(caseId);
                        this.classList.remove('active');
                        // 浅色模式下恢复原图标
                        if (theme === 'light' && iconImg) {
                            iconImg.src = 'images/collect icon.png';
                        }
                    } else {
                        // 收藏
                        saveBookmarkedCase(caseData);
                        this.classList.add('active');
                        // 浅色模式下切换为浅色图标
                        if (theme === 'light' && iconImg) {
                            iconImg.src = 'images/浅色Bookmark.png';
                        }
                    }
                    
                    // 添加视觉反馈
                    this.style.animation = 'none';
                    setTimeout(() => {
                        this.style.animation = 'bookmarkBounce 0.4s ease';
                    }, 10);
                });
                
                // 初始化收藏状态
                updateBookmarkButton();
                // 初始化浅色模式图标
                updateButtonIconsForLightMode();
            }
            
            // 转发功能
            if (shareBtn) {
                shareBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const theme = document.documentElement.getAttribute('data-theme');
                    const iconImg = this.querySelector('.action-icon-img');
                    
                    // 切换活跃状态
                    const isActive = this.classList.toggle('active');
                    
                    // 浅色模式下切换图标
                    if (theme === 'light' && iconImg) {
                        if (isActive) {
                            iconImg.src = 'images/浅色转发.png';
                        } else {
                            iconImg.src = 'images/转发icon.png';
                        }
                    }
                    
                    // 尝试使用 Web Share API，如果不支持则复制链接
                    if (navigator.share) {
                        navigator.share({
                            title: 'CyberBrick 4WD - Free 3D Printing Model - MakerWorld',
                            text: 'Check out this amazing 3D printing model!',
                            url: window.location.href
                        }).catch(err => {
                            console.log('Error sharing:', err);
                            copyToClipboard();
                        });
                    } else {
                        copyToClipboard();
                    }
                    
                    // 添加视觉反馈
                    this.style.animation = 'none';
                    setTimeout(() => {
                        this.style.animation = 'shareRotate 0.4s ease';
                    }, 10);
                });
            }
            
            // 链接按钮功能（第四个按钮）
            const linkBtn = document.querySelector('.link-action-btn');
            if (linkBtn) {
                // 移除原有的 onclick，改用事件监听器
                linkBtn.removeAttribute('onclick');
                linkBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const theme = document.documentElement.getAttribute('data-theme');
                    const iconImg = this.querySelector('.action-icon-img');
                    
                    // 切换活跃状态
                    const isActive = this.classList.toggle('active');
                    
                    // 浅色模式下切换图标
                    if (theme === 'light' && iconImg) {
                        if (isActive) {
                            iconImg.src = 'images/浅色link.png';
                        } else {
                            iconImg.src = 'images/link icon.png';
                        }
                    }
                    
                    // 执行原有的打开链接功能
                    window.open('https://makerworld.com.cn/zh/models/1949321-cyberbrick-si-qu-che#profileId-2165973', '_blank');
                });
            }
            
            // 初始化浅色模式图标（在页面加载和主题切换时调用）
            updateButtonIconsForLightMode();
            
            // 监听主题变化
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        updateAvatarImage(currentTheme);
                        updateButtonIconsForLightMode();
                        updateBackButtonIcon(currentTheme);
                        updateDropdownMenuIcons(currentTheme);
                    }
                });
            });
            observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['data-theme']
            });
            
            // 复制链接到剪贴板
            function copyToClipboard() {
                const url = window.location.href;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(url).then(() => {
                        showToast('Link copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        showToast('Failed to copy link');
                    });
                } else {
                    // 降级方案
                    const textarea = document.createElement('textarea');
                    textarea.value = url;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        showToast('Link copied to clipboard!');
                    } catch (err) {
                        console.error('Failed to copy:', err);
                        showToast('Failed to copy link');
                    }
                    document.body.removeChild(textarea);
                }
            }
            
            // 显示提示消息
            function showToast(message) {
                // 移除已存在的提示
                const existingToast = document.querySelector('.share-toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                const toast = document.createElement('div');
                toast.className = 'share-toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: rgba(62, 106, 226, 0.9);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 2000);
            }
        });
    </script>
    
    <style>
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        @keyframes slideInComment {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .comment-item.new-comment {
            animation: slideInComment 0.3s ease;
        }
    </style>
    
    <script>
        // 评论发布功能 - 优化版本
        document.addEventListener('DOMContentLoaded', function() {
            const commentInput = document.querySelector('.comment-input');
            const commentSubmitBtn = document.querySelector('.comment-submit-btn');
            const commentsList = document.querySelector('.comments-list');
            const commentsCount = document.querySelector('.comments-count');
            const charCount = document.querySelector('.comment-char-count');
            
            if (!commentInput || !commentSubmitBtn || !commentsList || !commentsCount) return;
            
            const MAX_LENGTH = 500;
            let isSubmitting = false;
            
            // 显示Toast提示消息
            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `comment-toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 2000);
            }
            
            // 更新字符计数
            function updateCharCount() {
                if (!charCount) return;
                const length = commentInput.value.length;
                charCount.textContent = `${length}/${MAX_LENGTH}`;
                
                if (length > 0) {
                    charCount.style.display = 'block';
                    if (length > MAX_LENGTH * 0.9) {
                        charCount.style.color = '#FF6B6B';
                    } else {
                        charCount.style.color = '#BAD0FF';
                    }
                } else {
                    charCount.style.display = 'none';
                }
            }
            
            // 更新提交按钮状态
            function updateSubmitButton() {
                const hasText = commentInput.value.trim().length > 0;
                const isValid = commentInput.value.trim().length <= MAX_LENGTH && !isSubmitting;
                
                if (hasText && isValid) {
                    commentSubmitBtn.disabled = false;
                    commentSubmitBtn.style.opacity = '1';
                    commentSubmitBtn.style.cursor = 'pointer';
                } else {
                    commentSubmitBtn.disabled = true;
                    commentSubmitBtn.style.opacity = '0.5';
                    commentSubmitBtn.style.cursor = 'not-allowed';
                }
            }
            
            // 获取当前评论数量
            function getCurrentCommentCount() {
                return parseInt(commentsCount.textContent) || 0;
            }
            
            // 更新评论数量
            function updateCommentCount(count) {
                commentsCount.textContent = count;
                // 添加计数更新动画
                commentsCount.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    commentsCount.style.transform = 'scale(1)';
                }, 200);
            }
            
            // 格式化时间
            function formatTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) {
                    return 'just now';
                } else if (diffMins < 60) {
                    return `${diffMins} ${diffMins === 1 ? 'minute' : 'minutes'} ago`;
                } else if (diffHours < 24) {
                    return `${diffHours} ${diffHours === 1 ? 'hour' : 'hours'} ago`;
                } else if (diffDays < 7) {
                    return `${diffDays} ${diffDays === 1 ? 'day' : 'days'} ago`;
                } else {
                    return date.toLocaleDateString();
                }
            }
            
            // 创建评论元素（使用createElement，更安全）
            function createCommentElement(text) {
                const now = new Date();
                const currentUser = 'You';
                const timeAgo = formatTimeAgo(now);
                
                const article = document.createElement('article');
                article.className = 'comment-item new-comment';
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'comment-avatar';
                const avatarImg = document.createElement('img');
                avatarImg.src = 'images/头像.png';
                avatarImg.alt = 'Avatar';
                avatarImg.className = 'comment-avatar-img';
                avatarDiv.appendChild(avatarImg);
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'comment-content';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'comment-header';
                const authorSpan = document.createElement('span');
                authorSpan.className = 'comment-author';
                authorSpan.textContent = currentUser;
                const timeSpan = document.createElement('span');
                timeSpan.className = 'comment-time';
                timeSpan.textContent = timeAgo;
                headerDiv.appendChild(authorSpan);
                headerDiv.appendChild(timeSpan);
                
                const textP = document.createElement('p');
                textP.className = 'comment-text';
                textP.textContent = text;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'comment-actions';
                
                const likeBtn = document.createElement('button');
                likeBtn.className = 'comment-like-btn';
                likeBtn.setAttribute('aria-label', 'Like comment');
                const likeImg = document.createElement('img');
                likeImg.src = 'images/heart icon.png';
                likeImg.alt = 'Like';
                likeImg.className = 'comment-like-icon';
                const likeSpan = document.createElement('span');
                likeSpan.textContent = '0';
                likeBtn.appendChild(likeImg);
                likeBtn.appendChild(likeSpan);
                
                const replyBtn = document.createElement('button');
                replyBtn.className = 'comment-reply-btn';
                replyBtn.textContent = 'Reply';
                
                actionsDiv.appendChild(likeBtn);
                actionsDiv.appendChild(replyBtn);
                
                contentDiv.appendChild(headerDiv);
                contentDiv.appendChild(textP);
                contentDiv.appendChild(actionsDiv);
                
                article.appendChild(avatarDiv);
                article.appendChild(contentDiv);
                
                return article;
            }
            
            // 为新评论添加点赞功能
            function attachLikeHandler(likeBtn) {
                likeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isCurrentlyActive = this.classList.contains('active');
                    const likeCountSpan = this.querySelector('span');
                    
                    if (likeCountSpan) {
                        let currentCount = parseInt(likeCountSpan.textContent) || 0;
                        
                        if (isCurrentlyActive) {
                            this.classList.remove('active');
                            currentCount = Math.max(0, currentCount - 1);
                        } else {
                            this.classList.add('active');
                            currentCount = currentCount + 1;
                        }
                        
                        likeCountSpan.textContent = currentCount;
                    } else {
                        this.classList.toggle('active');
                    }
                });
            }
            
            // 发布评论
            function publishComment() {
                if (isSubmitting) return;
                
                const commentText = commentInput.value.trim();
                
                // 验证评论
                if (!commentText) {
                    showToast('Please enter a comment', 'error');
                    commentInput.classList.add('error');
                    setTimeout(() => {
                        commentInput.classList.remove('error');
                    }, 1000);
                    commentInput.focus();
                    return;
                }
                
                if (commentText.length > MAX_LENGTH) {
                    showToast(`Comment is too long (max ${MAX_LENGTH} characters)`, 'error');
                    return;
                }
                
                // 设置提交状态
                isSubmitting = true;
                commentSubmitBtn.disabled = true;
                commentSubmitBtn.classList.add('loading');
                
                // 模拟提交延迟（实际项目中这里会是API调用）
                setTimeout(() => {
                    // 创建新评论元素
                    const newComment = createCommentElement(commentText);
                    
                    // 将新评论插入到列表顶部
                    commentsList.insertBefore(newComment, commentsList.firstChild);
                    
                    // 为新评论添加点赞功能
                    const newLikeBtn = newComment.querySelector('.comment-like-btn');
                    if (newLikeBtn) {
                        attachLikeHandler(newLikeBtn);
                    }
                    
                    // 更新评论数量
                    const currentCount = getCurrentCommentCount();
                    updateCommentCount(currentCount + 1);
                    
                    // 清空输入框
                    commentInput.value = '';
                    updateCharCount();
                    updateSubmitButton();
                    
                    // 显示成功提示
                    showToast('Comment published successfully!', 'success');
                    
                    // 滚动到新评论位置
                    newComment.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                    // 重置提交状态
                    isSubmitting = false;
                    commentSubmitBtn.classList.remove('loading');
                    updateSubmitButton();
                    
                    // 自动聚焦输入框
                    setTimeout(() => {
                        commentInput.focus();
                    }, 300);
                }, 300);
            }
            
            // 输入框事件监听
            commentInput.addEventListener('input', function() {
                updateCharCount();
                updateSubmitButton();
                
                // 清除错误状态
                this.classList.remove('error');
            });
            
            // 点击提交按钮发布评论
            commentSubmitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (!this.disabled && !isSubmitting) {
                    publishComment();
                }
            });
            
            // 按Enter键发布评论（Shift+Enter换行）
            commentInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!commentSubmitBtn.disabled && !isSubmitting) {
                        publishComment();
                    }
                }
            });
            
            // 输入框获得焦点时的效果
            commentInput.addEventListener('focus', function() {
                commentInput.parentElement.classList.add('focused');
                updateSubmitButton();
            });
            
            // 输入框失去焦点时的效果
            commentInput.addEventListener('blur', function() {
                commentInput.parentElement.classList.remove('focused');
                setTimeout(() => {
                    updateSubmitButton();
                }, 200);
            });
            
            // 初始化
            updateSubmitButton();
        });

</script>
    
    <style>
        /* 新评论动画 */
        @keyframes slideInComment {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .comment-item.new-comment {
            animation: slideInComment 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 字符计数样式 */
        .comment-char-count {
            font-family: 'HarmonyOS Sans SC', sans-serif;
            font-size: 12px;
            color: #BAD0FF;
            text-align: right;
            margin-top: 4px;
            transition: color 0.2s ease;
        }
        
        /* 输入框错误状态 */
        .comment-input.error {
            border: 1px solid #FF6B6B !important;
            animation: shake 0.4s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* 提交按钮加载状态 */
        .comment-submit-btn.loading {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .comment-submit-btn.loading .comment-send-icon {
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Toast提示样式 */
        .comment-toast {
            position: fixed;
            bottom: 100px;
            right: 50%;
            transform: translateX(50%) translateY(20px);
            background: rgba(0, 0, 0, 0.85);
            color: #FFFFFF;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'HarmonyOS Sans SC', sans-serif;
            font-size: 14px;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .comment-toast.show {
            opacity: 1;
            transform: translateX(50%) translateY(0);
        }
        
        .comment-toast.error {
            background: rgba(255, 107, 107, 0.9);
        }
        
        .comment-toast.success {
            background: rgba(62, 106, 226, 0.9);
        }
        
        /* 输入框聚焦状态 */
        .comment-input-wrapper.focused {
            transform: scale(1.01);
            transition: transform 0.2s ease;
        }
        
        /* 评论计数动画 */
        .comments-count {
            transition: transform 0.2s ease;
        }
    </style>
    
    <style>
        /* 新评论动画 */
        @keyframes slideInComment {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .comment-item.new-comment {
            animation: slideInComment 0.3s ease;
        }
    </style>
</body>
</html>

