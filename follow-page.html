<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Follow Page">
    <title>Follow</title>
    <link rel="stylesheet" href="follow-page.css">
</head>
<body>
    <div class="container">
        <!-- 顶部标题区域 -->
        <section class="top-section">
            <div class="title-container">
                <h1 class="page-title">Following</h1>
                <p class="page-subtitle">View all creators and cases you're following</p>
            </div>
        </section>

        <!-- 内容区域 -->
        <section class="content-section">
            <div class="content-container">
                <!-- 关注的内容列表 -->
                <div class="follow-list" id="followList">
                    <!-- 关注项将通过JavaScript动态加载 -->
                </div>
                
                <!-- 空状态提示 -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">
                        <img src="images/follow page icon.png" alt="Follow Icon" class="empty-icon-img">
                    </div>
                    <h2 class="empty-title">Not following anyone yet</h2>
                    <p class="empty-text">Discover and follow creators to see their latest work!</p>
                    <button class="empty-btn" onclick="window.location.href='index.html'">Explore Cases</button>
                </div>
            </div>
        </section>

        <!-- 左上角返回按钮 -->
        <button class="back-btn" onclick="window.location.href='index.html'" aria-label="返回">
            <img src="images/back icon.png" alt="Back" class="back-icon-img">
        </button>
        
        <!-- 右上角头像按钮和下拉菜单 -->
        <div class="user-menu-container">
            <button class="user-avatar-btn" id="userMenuBtn" aria-label="用户菜单">
                <img src="images/头像.png" alt="用户头像" class="user-avatar-img">
            </button>
            <!-- 用户下拉菜单 -->
            <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
                <!-- 顶部区域：头像和用户信息 -->
                <div class="menu-header">
                    <div class="menu-header-info">
                        <img src="images/头像.png" alt="个人头像" class="menu-header-avatar">
                        <div class="menu-header-user-info">
                            <div class="menu-header-user-name">User Name</div>
                            <div class="menu-header-user-email">user@example.com</div>
                        </div>
                    </div>
                    <button class="menu-switch-btn" aria-label="切换">
                        <img src="images/切换icon.png" alt="切换" class="menu-switch-icon">
                    </button>
                </div>
                <!-- 菜单项列表 -->
                <div class="menu-items-list">
                    <a href="like-page.html" class="menu-item">
                        <img src="images/heart icon.png" alt="likes" class="menu-item-icon">
                        <span class="menu-item-text">Likes</span>
                    </a>
                    <a href="collect-page.html" class="menu-item">
                        <img src="images/collect icon.png" alt="collect" class="menu-item-icon">
                        <span class="menu-item-text">Collect</span>
                    </a>
                    <a href="follow-page.html" class="menu-item">
                        <img src="images/follow icon.png" alt="follow" class="menu-item-icon">
                        <span class="menu-item-text">Follow</span>
                    </a>
                    <div class="menu-divider"></div>
                    <a href="#" class="menu-item">
                        <img src="images/Settings icon.png" alt="setting" class="menu-item-icon">
                        <span class="menu-item-text">Settings</span>
                    </a>
                    <a href="#" class="menu-item menu-item-danger">
                        <img src="images/sign out icon.png" alt="sign out" class="menu-item-icon">
                        <span class="menu-item-text">Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 读取主题设置 -->
    <script>
        // 从localStorage读取保存的主题并应用到页面
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // 更新右上角头像的函数
        function updateAvatarImage(theme) {
            const userAvatarImg = document.querySelector('.user-avatar-img');
            if (userAvatarImg) {
                userAvatarImg.src = theme === 'light' ? 'images/白头像.png' : 'images/头像.png';
            }
        }
        
        // 更新下拉菜单图标的函数
        function updateDropdownMenuIcons(theme) {
            const menuHeaderAvatar = document.querySelector('.menu-header-avatar');
            const menuSwitchIcon = document.querySelector('.menu-switch-icon');
            const menuItemIcons = document.querySelectorAll('.menu-item-icon');
            
            // 更新菜单头部头像
            if (menuHeaderAvatar) {
                menuHeaderAvatar.src = theme === 'light' ? 'images/白头像.png' : 'images/头像.png';
            }
            
            // 更新切换按钮图标
            if (menuSwitchIcon) {
                menuSwitchIcon.src = theme === 'light' ? 'images/白Transfer.png' : 'images/切换icon.png';
            }
            
            // 更新菜单项图标（从上到下）
            if (menuItemIcons.length > 0) {
                const lightIcons = [
                    'images/白Heart.png',      // Likes
                    'images/白Bookmark.png',   // Collect
                    'images/白Add User Male.png', // Follow
                    'images/白Settings.png',   // Settings
                    'images/白Logout Rounded.png' // Sign Out
                ];
                const darkIcons = [
                    'images/heart icon.png',
                    'images/collect icon.png',
                    'images/follow icon.png',
                    'images/Settings icon.png',
                    'images/sign out icon.png'
                ];
                
                menuItemIcons.forEach((icon, index) => {
                    if (index < lightIcons.length) {
                        icon.src = theme === 'light' ? lightIcons[index] : darkIcons[index];
                    }
                });
            }
        }
        
        // 更新返回按钮图标的函数
        function updateBackButtonIcon(theme) {
            const backIconImg = document.querySelector('.back-icon-img');
            if (backIconImg) {
                backIconImg.src = theme === 'light' ? 'images/浅色back button.png' : 'images/back icon.png';
            }
        }
        
        // 更新空状态图标的函数
        function updateEmptyIcon(theme) {
            const emptyIconImg = document.querySelector('.empty-icon-img');
            if (emptyIconImg) {
                emptyIconImg.src = theme === 'light' ? 'images/浅色follow pageicon.png' : 'images/follow page icon.png';
            }
        }
        
        // 初始化右上角头像
        updateAvatarImage(savedTheme);
        // 初始化下拉菜单图标
        updateDropdownMenuIcons(savedTheme);
        // 初始化返回按钮图标
        updateBackButtonIcon(savedTheme);
        // 初始化空状态图标
        updateEmptyIcon(savedTheme);
        
        // 监听主题变化
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    updateAvatarImage(currentTheme);
                    updateDropdownMenuIcons(currentTheme);
                    updateBackButtonIcon(currentTheme);
                    updateEmptyIcon(currentTheme);
                }
            });
        });
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });
    </script>
    
    <!-- JavaScript 控制用户菜单 -->
    <script>
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdownMenu = document.getElementById('userDropdownMenu');
        
        if (userMenuBtn && userDropdownMenu) {
            userMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const isVisible = userDropdownMenu.style.display === 'block';
                userDropdownMenu.style.display = isVisible ? 'none' : 'block';
            });
            
            // 点击外部关闭菜单
            document.addEventListener('click', function(e) {
                if (!userMenuBtn.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                    userDropdownMenu.style.display = 'none';
                }
            });
        }
    </script>

    <!-- JavaScript 加载关注的内容 -->
    <script>
        // 从localStorage获取关注的designer列表
        function getFollowedDesigners() {
            const followed = localStorage.getItem('followedDesigners');
            return followed ? JSON.parse(followed) : [];
        }

        // 创建关注Designer HTML
        function createFollowItem(designerInfo) {
            return `
                <article class="follow-item creator-item">
                    <div class="follow-avatar">
                        <img src="${designerInfo.avatar || 'images/头像.png'}" alt="${designerInfo.name}" class="follow-avatar-img">
                    </div>
                    <div class="follow-info">
                        <h3 class="follow-name">${designerInfo.name}</h3>
                        <p class="follow-description">${designerInfo.description || 'Creative designer'}</p>
                        <div class="follow-stats">
                            <span class="stat-text">${designerInfo.caseCount || 0} cases</span>
                        </div>
                    </div>
                    <button class="follow-btn active" data-designer="${designerInfo.name}" onclick="toggleFollowDesigner('${designerInfo.name}')">
                        <span>Following</span>
                    </button>
                </article>
            `;
        }

        // 加载关注的Designer
        function loadFollowedItems() {
            const followedDesigners = getFollowedDesigners();
            const followList = document.getElementById('followList');
            const emptyState = document.getElementById('emptyState');

            if (!followedDesigners || followedDesigners.length === 0) {
                if (followList) followList.style.display = 'none';
                if (emptyState) emptyState.style.display = 'flex';
                return;
            }

            if (followList) followList.style.display = 'block';
            if (emptyState) emptyState.style.display = 'none';
            if (followList) followList.innerHTML = '';

            // 显示被关注的Designer（使用从localStorage读取的完整数据）
            followedDesigners.forEach(designerInfo => {
                // 兼容旧数据格式（如果存储的是字符串而不是对象）
                const designer = typeof designerInfo === 'string' 
                    ? { name: designerInfo, avatar: 'images/头像.png', description: 'Creative designer', caseCount: 0 }
                    : designerInfo;
                
                if (followList) {
                    followList.innerHTML += createFollowItem(designer);
                }
            });
        }

        // 切换关注Designer状态
        function toggleFollowDesigner(designerName) {
            let followedDesigners = getFollowedDesigners();
            const followBtn = document.querySelector(`.follow-btn[data-designer="${designerName}"]`);

            if (followedDesigners.some(d => (typeof d === 'string' ? d : d.name) === designerName)) {
                // 取消关注
                followedDesigners = followedDesigners.filter(d => {
                    const name = typeof d === 'string' ? d : d.name;
                    return name !== designerName;
                });
                localStorage.setItem('followedDesigners', JSON.stringify(followedDesigners));
                // 重新加载列表
                setTimeout(() => loadFollowedItems(), 100);
            } else {
                // 添加关注（不应该到这里，因为按钮只显示已关注的）
                const designerData = {
                    name: designerName,
                    avatar: 'images/头像.png',
                    description: 'Creative designer',
                    caseCount: 0
                };
                followedDesigners.push(designerData);
                localStorage.setItem('followedDesigners', JSON.stringify(followedDesigners));
                if (followBtn) {
                    followBtn.classList.add('active');
                    const span = followBtn.querySelector('span');
                    if (span) span.textContent = 'Following';
                }
                setTimeout(() => loadFollowedItems(), 100);
            }
        }

        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', function() {
            loadFollowedItems();
        });
        
        // 页面可见性变化时重新加载（从其他页面返回时）
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadFollowedItems();
            }
        });
        
        // 窗口获得焦点时重新加载
        window.addEventListener('focus', function() {
            loadFollowedItems();
        });
    </script>
</body>
</html>

